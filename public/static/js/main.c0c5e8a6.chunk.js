(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{17:function(e,n,t){e.exports=t.p+"static/media/cube.4b2be875.svg"},24:function(e,n,t){e.exports=t(35)},33:function(e,n,t){},34:function(e,n,t){},35:function(e,n,t){"use strict";t.r(n);var o=t(2),r=t.n(o),a=t(11),i=t.n(a),c=t(12),s=t(8),l=t(21),d={isPending:!1,error:"",models:{},config:[]},u={isLoading:!1,error:""},m={ui:null},h=Object(s.c)({gameLoading:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(n.type){case"GAME_LOADING_ERROR":return Object.assign({},e,{error:n.payload,isPending:!1});case"GAME_LOADING_PENDING":return Object.assign({},e,{isPending:!0});case"GAME_LOADING_FINISH":return Object.assign({},e,{isPending:!1,models:n.payload.models,config:n.payload.config});default:return e}},worldLoading:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(n.type){case"WORLD_LOADING_ERROR":return Object.assign({},e,{error:n.payload,isLoading:!1});case"WORLD_LOADING_PENDING":return Object.assign({},e,{isLoading:!0});case"WORLD_LOADING_FINISH":return Object.assign({},e,{isLoading:!1});default:return e}},uiUpdate:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(n.type){case"UI_BLOCK_TYPE":return Object.assign({},e,{ui:n.payload});default:return e}}}),f=t(1),p=t(4),g=t(5),w=t(3),y=t(6),v=t(0),E=t(16),O=t(23),L=t(9),b=t(22),I=t.n(b),_=function e(n){var t=this;Object(f.a)(this,e),this.Cloud=function(e){var n=e.x,o=e.y,r=e.z,a=t.models.cloud,i=new v.Mesh(a.geometry,a.material);return i.name="cloud",i.userData={type:"Cloud",faction:"none"},i.position.set(n,o,r),i},this.Water=function(e){var n=e.x,o=e.y,r=e.z,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=t.models.water,c=new v.Mesh(i.geometry,i.material);return c.name="water",c.userData={type:"Water",faction:a,attached:[],build:["Port","Water Temple"]},c.position.set(n,o,r),c},this.Field=function(e){var n=e.x,o=e.y,r=e.z,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=t.models.field,c=new v.Mesh(i.geometry,i.material);return c.addEventListener("click",function(e){console.log("You clicked a Field Block")}),c.name="base_field",c.userData={type:"Field",faction:a,attached:[],build:["Road","Farm","Sawmill","GrowForest"]},c.position.set(n,o,r),c},this.Ocean=function(e){var n=e.x,o=e.y,r=e.z,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=t.models.ocean,c=new v.Mesh(i.geometry,i.material);return c.name="ocean",c.userData={type:"Ocean",faction:a,attached:[],build:["Water Temple"]},c.position.set(n,o,r),c},this.Fruit=function(e,n){var o=e.x,r=e.y,a=e.z,i=t.models.fruit,c=new v.Mesh(i.geometry,i.material);return c.name="fruit_typeOne",c.userData={type:"Fruit",faction:n},c.position.set(o,r,a),c},this.Slector=function(e,n){var o=t.models.slector,r=new v.Mesh(o.geometry,o.material);return r.name="slector",r.userData={type:"Slector",user:e},r.position.set(0,n,0),r},this.models=n},D=function(){function e(n){var t=this;Object(f.a)(this,e),this.createWorldSeed=function(e,n){for(var o=[],r=0;r<e;r++){o[r]=[];for(var a=0;a<n;a++){var i=a/n-.5,c=r/e-.5;o[r][a]=t.noise(i,c)}}return o},this.genWorld=function(){var e=t.models.Slector,n=t.config,o=n.worldSize,r=n.factions;t.worldSeedArray=[],t.worldArray=[],t.coordZ=0,t.coordX=0,t.row=0,t.colum=0,t.createWorldSeed(o,o).forEach(function(e){e.forEach(function(e){t.worldSeedArray.push(t.intToBlock(e))})}),t.worldSeedArray.forEach(function(e){t.addToWorld(e,t.models),t.row++,t.coordZ+=.5,t.row>o-1&&(t.colum++,t.colum<o&&(t.row=0,t.coordZ=0,t.coordX+=.5))});for(var a=0;a<r.length;a++)t.config.scene.add(e(r[a],-(a+1)));t.addToScene(t.worldArray),console.log(t.config.scene)},this.addToWorld=function(e,n){var o=n.Field,r=n.Ocean,a=n.Water;switch(e){case"OCEAN":return void t.worldArray.push(r({x:t.coordX,y:0,z:t.coordZ},null));case"FIELD":return void t.worldArray.push(o({x:t.coordX,y:0,z:t.coordZ},null));case"WATER":return void t.worldArray.push(a({x:t.coordX,y:0,z:t.coordZ},null));default:return}},this.addToScene=function(e){e.forEach(function(e){t.config.scene.add(e)})},this.intToBlock=function(e){return e<=.3?"OCEAN":e<.6&&e>.3?"WATER":"FIELD"},this.deleteWorld=function(e){for(var n=2;n>=e+2;n++)t.config.scene.children[n].mesh.geometry.dispose(),delete t.config.scene.children[n]},this.config=n,this.models=new _(n.models),this.genNoise=new I.a}return Object(p.a)(e,[{key:"noise",value:function(e,n){return this.genNoise.noise2D(e,n)/2+.5}}]),e}(),k=t(17),A=t.n(k),N=(t(33),function(e){var n=e.name,t=e.buildBlocks,o=e.update;return r.a.createElement("div",{className:"blockUI-root"},r.a.createElement("ul",{className:"blockUI-data"},r.a.createElement("li",{className:"block-UI"},r.a.createElement("img",{src:A.a,alt:"ImageIcon"})),r.a.createElement("li",{className:"block-UI"},r.a.createElement("p",null,n)),r.a.createElement("li",null,r.a.createElement("button",{onClick:function(){o(null)}},"^"))),r.a.createElement("div",{className:"blockUI-build"},t.map(function(e){return r.a.createElement("div",{className:"block-buildRoot",key:"Field_".concat(e),onClick:function(){console.log(e)}},r.a.createElement("div",null,r.a.createElement("p",null,r.a.createElement("span",null,"\u272f"),"5"),r.a.createElement("img",{src:A.a,alt:""})),r.a.createElement("p",null,e))})))}),R=(t(34),function(e){function n(){var e,t;Object(f.a)(this,n);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(t=Object(g.a)(this,(e=Object(w.a)(n)).call.apply(e,[this].concat(a)))).start=function(){t.frameId||(t.frameId=requestAnimationFrame(t.animate))},t.stop=function(){cancelAnimationFrame(t.frameId)},t.animate=function(){t.renderScene(),t.frameId=window.requestAnimationFrame(t.animate)},t.renderScene=function(){var e=t.clock.getDelta();t.cameraControls.update(e);t.renderer.render(t.scene,t.camera),t.composer.render(e)},t.createWorld=function(){t.props.isPending||new D({config:t.props.config,models:t.props.models,scene:t.scene,worldSize:11,factions:["Xin-xi","Imperius"],state:[t.props.changeWorldState]}).genWorld()},t.handleResize=function(e){t.renderer.setSize(window.innerWidth,window.innerHeight),t.renderer.setPixelRatio(window.devicePixelRatio),t.camera.aspect=window.innerWidth/window.innerHeight,t.camera.updateProjectionMatrix()},t.blockClicked=function(e){var n=new v.Vector3(e.clientX/window.innerWidth*2-1,-e.clientY/window.innerHeight*2+1,.5);n.unproject(t.camera),t.raycaster.set(t.camera.position,n.sub(t.camera.position).normalize());var o=t.raycaster.intersectObjects(t.scene.children),a=t.scene.children.find(function(e){return"Imperius"===e.userData.user});if(o.length>0){var i=o[0].object,c=i.position;a.position.set(c.x,c.y,c.z),t.props.updateUI(r.a.createElement(N,{update:t.props.updateUI,name:i.userData.type,buildBlocks:i.userData.build}))}else a.position.set(0,-1,0),t.props.updateUI(null)},t}return Object(y.a)(n,e),Object(p.a)(n,[{key:"componentDidMount",value:function(){this.scene=new v.Scene,this.props.loadGameAssets(),E.a.install({THREE:v}),this.renderer=new v.WebGLRenderer({antialias:!0}),this.composer=new O.a(this.renderer),this.renderer.shadowMap.enabled=!0,this.renderer.autoClear=!1,this.renderer.setClearColor("#000000"),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setPixelRatio(window.devicePixelRatio),this.raycaster=new v.Raycaster,this.camera=new v.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),this.camera.rotation.set(0,0,0),this.camera.position.set(1,1,1),this.clock=new v.Clock,this.cameraControls=new E.a(this.camera,this.renderer.domElement),this.mount.appendChild(this.renderer.domElement),window.addEventListener("resize",this.handleResize),window.addEventListener("click",this.blockClicked),window.addEventListener("keydown",this.createWorld);var e=new v.DirectionalLight;e.position.setY(200),this.scene.add(e);var n=new v.HemisphereLight;this.scene.add(n),this.start()}},{key:"componentDidUpdate",value:function(){}},{key:"componentWillUnmount",value:function(){this.stop(),this.mount.removeChild(this.renderer.domElement)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{id:"three-scene",ref:function(n){e.mount=n}},this.props.ui)}}]),n}(o.Component)),W=Object(c.b)(function(e){return{error:e.gameLoading.error,isPending:e.gameLoading.isPending,models:e.gameLoading.models,config:e.gameLoading.config,isLoading:e.worldLoading.isLoading,ui:e.uiUpdate.ui}},function(e){return{loadGameAssets:function(){return e(function(e){var n={},t=[],o=new v.LoadingManager;o.onStart=function(){e({type:"GAME_LOADING_PENDING"})},o.onLoad=function(){e({type:"GAME_LOADING_FINISH",payload:{models:n,config:t}})},o.onError=function(n){e({type:"GAME_LOADING_ERROR",payload:n})},o.onProgress=function(e,n,t){console.log("Loading file: ".concat(e," .\n Loaded ").concat(n," of ").concat(t," files."))};var r=new v.FileLoader(o).setPath("./config/").setResponseType("json");r.load("config.json",function(e){t.push(e)}),r.load("mods.json",function(e){t.push(e)});var a=new L.MTLLoader(o).setPath("./models/");a.load("field.mtl",function(e){e.preload(),new L.OBJLoader(o).setPath("./models/").setMaterials(e).load("field.obj",function(e){n.field={geometry:e.children[0].geometry,material:e.children[0].material}})}),a.load("cloud.mtl",function(e){e.preload(),new L.OBJLoader(o).setPath("./models/").setMaterials(e).load("cloud.obj",function(e){n.cloud={geometry:e.children[0].geometry,material:e.children[0].material}})}),a.load("water.mtl",function(e){e.preload(),new L.OBJLoader(o).setPath("./models/").setMaterials(e).load("water.obj",function(e){n.water={geometry:e.children[0].geometry,material:e.children[0].material}})}),a.load("slector.mtl",function(e){e.preload(),new L.OBJLoader(o).setPath("./models/").setMaterials(e).load("slector.obj",function(e){n.slector={geometry:e.children[0].geometry,material:e.children[0].material}})}),a.load("ocean.mtl",function(e){e.preload(),new L.OBJLoader(o).setPath("./models/").setMaterials(e).load("ocean.obj",function(e){n.ocean={geometry:e.children[0].geometry,material:e.children[0].material}})}),a.load("fruit_t_one.mtl",function(e){e.preload(),new L.OBJLoader(o).setPath("./models/").setMaterials(e).load("fruit_t_one.obj",function(e){n.fruit={geometry:e.children[0].geometry,material:e.children[0].material}})})})},changeWorldState:function(){return e(function(e){switch(n.toLowercase()){case"loading":e({type:"WORLD_LOADING_PENDING"});break;case"error":e({type:"WORLD_LOADING_ERROR",payload:t});break;case"finish":e({type:"WORLD_LOADING_FINISH"})}});var n,t},updateUI:function(n){return e(function(e){return function(n){n({type:"UI_BLOCK_TYPE",payload:e})}}(n))}}})(R);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var j=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||s.d,P=Object(s.e)(h,j(Object(s.a)(l.a)));i.a.render(r.a.createElement(c.a,{store:P},r.a.createElement(W,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[24,1,2]]]);
//# sourceMappingURL=main.c0c5e8a6.chunk.js.map